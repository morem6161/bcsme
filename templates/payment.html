{% extends "base.html" %}

{% block title %}Payment - BCSME Membership{% endblock %}

{% block content %}
<div class="payment-container">
    <h2>Complete Your Membership Payment</h2>
    
    <div class="payment-summary">
        <h3>Application Summary</h3>
        <p><strong>Name:</strong> {{ member.name }}</p>
        <p><strong>Email:</strong> {{ member.email }}</p>
        <p><strong>Membership Category:</strong> {{ member.membership_category }}</p>
        <p><strong>Annual Fee:</strong> ${{ "%.2f"|format(member.membership_fee) }}</p>
    </div>
    
    <div class="payment-info">
        <h3>Payment Options</h3>
        <p>Please select your payment method:</p>
        
        <div class="payment-methods">
            <!-- PayPal Button -->
            <div class="payment-option">
                <h4>Pay Online with PayPal</h4>
                <p>Secure payment via PayPal (credit card, debit, or PayPal balance)</p>
                <div id="paypal-button-container"></div>
            </div>
            
            <div class="payment-option">
                <h4>Pay In Person</h4>
                <p>You can also pay by:</p>
                <ul>
                    <li><strong>Cash or Cheque</strong> - Visit us at Rainbow Creek Station</li>
                    <li><strong>Debit or Credit Card</strong> - Pay in person at 120 North Willingdon Avenue, Burnaby</li>
                </ul>
                <p class="note">Your application will remain pending until payment is received.</p>
                <a href="{{ url_for('payment_success', member_id=member.id, payment_id='PENDING_IN_PERSON') }}" class="btn btn-secondary">
                    I'll Pay In Person
                </a>
            </div>
        </div>
    </div>
    
    <div class="payment-note">
        <p><strong>Note:</strong> After payment, your application will be reviewed by the Board at our next monthly meeting. You will receive a confirmation email once approved.</p>
        <p><strong>Questions?</strong> Contact us at <a href="mailto:secretary@bcsme.org">secretary@bcsme.org</a></p>
    </div>
</div>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=CAD"></script>

<script>
paypal.Buttons({
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                description: 'BCSME {{ member.membership_category }} Membership - {{ member.name }}',
                amount: {
                    currency_code: 'CAD',
                    value: '{{ "%.2f"|format(member.membership_fee) }}'
                }
            }]
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            // Redirect to success page with payment ID
            window.location.href = '{{ url_for("payment_success", member_id=member.id) }}?payment_id=' + details.id;
        });
    },
    onError: function(err) {
        alert('Payment failed. Please try again or contact us at secretary@bcsme.org');
        console.error('PayPal error:', err);
    }
}).render('#paypal-button-container');
</script>

<style>
.payment-container {
    max-width: 800px;
    margin: 0 auto;
}

.payment-summary {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
}

.payment-methods {
    display: grid;
    gap: 20px;
    margin: 30px 0;
}

.payment-option {
    background: white;
    border: 2px solid #ddd;
    padding: 20px;
    border-radius: 8px;
}

.payment-option h4 {
    margin-top: 0;
    color: #2c5f2d;
}

.payment-note {
    background: #fff3cd;
    padding: 20px;
    border-radius: 8px;
    margin-top: 30px;
}

#paypal-button-container {
    margin: 20px 0;
}
</style>
{% endblock %}
